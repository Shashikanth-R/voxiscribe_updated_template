{% extends "layout.html" %}
{% block content %}
<div class="card" style="max-width:600px;margin:40px auto;">
  <h2>Exam Instructions</h2>
  <p>Before you begin, please read the instructions below. You can start the exam by clicking the button or saying <b>"Start Exam"</b>.</p>
  <ul>
    <li>Use your voice to navigate and answer questions.</li>
    <li>Supported voice commands:
      <ul>
        <li><b>Start Recording</b> / <b>Start Answering</b>: Begin voice-to-text for the current question.</li>
        <li><b>Stop Recording</b> / <b>Stop Answering</b>: Stop voice transcription.</li>
        <li><b>Next Question</b> / <b>Next</b>: Go to the next question.</li>
        <li><b>Previous Question</b> / <b>Back</b>: Go to the previous question.</li>
        <li><b>Submit Exam</b> / <b>Submit</b>: Submit all answers.</li>
        <li><b>Repeat Question</b>: Hear the current question again.</li>
      </ul>
    </li>
    <li>All buttons on the exam page can be triggered by voice commands.</li>
  </ul>
  <button id="start-exam-btn" class="btn btn-primary" style="margin-top:24px;">Start Exam</button>
</div>
<script>
(function(){
  // Voice command: "Start Exam" or button click
  function goToExam() {
    const urlParams = new URLSearchParams(window.location.search);
    const examId = urlParams.get('exam_id');
    if (examId) {
      window.location.href = `/take_exam/${examId}`;
    } else {
      alert('Exam ID missing.');
    }
  }
  document.getElementById('start-exam-btn').onclick = goToExam;
  let recognition;
  function startVoiceRecognition() {
    if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) return;
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang = 'en-US';
    recognition.onresult = function(event) {
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          const transcript = event.results[i][0].transcript.trim().toLowerCase();
          if (transcript.includes('start exam')) {
            goToExam();
          }
        }
      }
    };
    recognition.onerror = function() {};
    recognition.onend = function() {
      recognition.start();
    };
    recognition.start();
  }
  document.addEventListener('DOMContentLoaded', function(){
    startVoiceRecognition();
  });
})();
</script>
{% endblock %}
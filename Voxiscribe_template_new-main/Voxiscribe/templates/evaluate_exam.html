{% extends 'layout.html' %}
{% block title %}Evaluate Exam - Voxiscribe{% endblock %}
{% block content %}
<h2>Evaluate Exam: {{ exam.title }}</h2>
<div class="card">
  <h3>Student Submissions</h3>
  {% if students %}
    <div class="student-eval-list">
      {% for student in students %}
      <div class="student-eval-box" data-student-id="{{ student.student_id }}">
        <div class="student-header">
            <h4>{{ student.username }} (ID: {{ student.student_id }})</h4>
            <div class="total-score">
                <strong>Total Score: </strong><span class="score-value">{{ student.total_score|default('N/A', true) }}</span>
            </div>
        </div>
        <div class="questions-list">
          {% for qa in student_answers[student.student_id] %}
          <div class="question-box" data-question-id="{{ qa.question_id }}">
            <strong>Q{{ loop.index }}: {{ qa.question_text }}</strong>
            {% if qa.question_type.lower() == 'descriptive' %}
              <div class="answer-text">{{ qa.answer_text }}</div>
              <div class="eval-actions">
                <button class="btn btn-warning plagiarism-btn">Plagiarism Check</button>
                <span class="plagiarism-result"></span>
                <input type="number" class="mark-input" placeholder="Marks" value="{{ qa.score|default('', true) }}">
              </div>
            {% else %}
              <div class="answer-text">Selected option: {{ qa.selected_option }}</div>
              <div>Correct Answer: {{ qa.correct_answer }}</div>
              <div>Score: {{ qa.score }}</div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        <button class="btn btn-success finish-eval-btn">Finish Evaluation</button>
      </div>
      {% endfor %}
    </div>
    <a class="btn" href="{{ url_for('download_results', exam_id=exam.id) }}">Download Updated CSV</a>
  {% else %}
    <p>No student submissions found for this exam.</p>
  {% endif %}
</div>
<script src="{{ url_for('static', filename='js/evaluate_exam.js') }}"></script>
{% endblock %}
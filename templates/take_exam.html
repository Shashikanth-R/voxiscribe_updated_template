{% extends "layout.html" %}
{% block content %}
<div class="exam-layout">
  <div class="nav-panel" id="nav-panel"></div>
  <div class="card main-panel">
    <h1 id="exam-title">Exam</h1>
    <div id="timer" class="mb-2">Time Left: <span id="time"></span></div>
    <div id="question-container"></div>
    <div class="controls mt-2">
      <button id="voice-record" class="btn btn-secondary">Start Recording</button>
      <button id="voice-stop" class="btn btn-secondary" style="display:none;">Stop</button>
      <button id="mark-review" class="btn btn-warning">Mark for Review</button>
      <button id="prev-question" class="btn btn-secondary">Previous</button>
      <button id="next-question" class="btn">Next</button>
      <button id="submit-exam" class="btn btn-danger">Submit Exam</button>
    </div>
    <div id="live-transcript" style="margin-top:16px; min-height:32px; color:#333; font-style:italic; background:#f8f9fa; border-radius:6px; padding:8px 12px; display:none;"></div>
  </div>
</div>
<script id="exam-data" type="application/json">{{ exam_json | safe }}</script>
<script src="{{ url_for('static', filename='js/exam.js') }}"></script>
<script src="{{ url_for('static', filename='js/voice.js') }}"></script>
<div id="proctor-consent" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; display:flex; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:32px; border-radius:12px; text-align:center;">
        <h2>Proctoring Consent</h2>
        <p>This exam requires video and audio proctoring.</p>
        <p>Please grant permission to access your webcam and microphone.</p>
        <button id="proctor-consent-btn" class="btn btn-primary">I Understand and Consent</button>
    </div>
</div>

<div id="proctoring-videobox" style="position:fixed; bottom:24px; right:24px; width:320px; height:240px; background:#222; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.18); z-index:1000; display:none; flex-direction:column; align-items:center; justify-content:center; padding:12px; border:2px solid #e53935;">
    <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
        <span style="background:#e53935; color:#fff; border-radius:4px; padding:2px 8px; font-weight:bold; font-size:14px;">REC</span>
        <span id="proctor-elapsed" style="color:#fff; font-size:13px;">00:00</span>
    </div>
    <video id="proctor-video" autoplay muted playsinline style="width:100%; height:160px; background:#111; border-radius:8px; object-fit:cover;"></video>
</div>

<script src="{{ url_for('static', filename='js/proctoring.js') }}"></script>
<style>
.exam-layout { display: flex; gap: 24px; }
.nav-panel { min-width: 120px; background: #f4f4f4; border-radius: 8px; padding: 16px; display: flex; flex-direction: column; gap: 8px; }
.nav-btn { width: 40px; height: 40px; border-radius: 50%; border: none; font-weight: bold; font-size: 16px; cursor: pointer; margin-bottom: 4px; }
.nav-btn.answered { background: #d4edda; color: #155724; }
.nav-btn.unanswered { background: #f8d7da; color: #721c24; }
.nav-btn.review { background: #fff3cd; color: #856404; border: 2px solid #ffeeba; }
.main-panel { flex: 1; }
.option { display: block; margin: 8px 0; }
.answer-input { width: 100%; min-height: 120px; }
.listening { animation: pulse 1s infinite; }
#live-transcript { transition: opacity 0.2s; }
@keyframes pulse { 0%{ transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
</style>
{% endblock %}
<body>
    <!-- Existing exam UI -->
    <div id="exam-root">
        <!-- ... existing exam content ... -->
    </div>
    <!-- Proctoring VideoBox -->
    <div id="proctoring-videobox" style="position:fixed; bottom:24px; right:24px; width:320px; height:240px; background:#222; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.18); z-index:1000; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:12px; border:2px solid #e53935;">
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
        <span style="background:#e53935; color:#fff; border-radius:4px; padding:2px 8px; font-weight:bold; font-size:14px;">REC</span>
        <span id="proctor-elapsed" style="color:#fff; font-size:13px;">00:00</span>
        <span id="proctor-mic" style="color:#fff; font-size:16px; margin-left:8px;">ðŸŽ¤</span>
      </div>
      <video id="proctor-video" autoplay muted playsinline style="width:100%; height:160px; background:#111; border-radius:8px; object-fit:cover;"></video>
    </div>
    <script src="{{ url_for('static', filename='js/proctoring.js') }}"></script>
</body>